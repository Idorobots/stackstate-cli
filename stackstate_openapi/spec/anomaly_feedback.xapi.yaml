paths:
  /anomaly-feedback:
    get:
      tags:
        - anomalyFeedback
      summary: ""
      description: ""
      parameters:
        - name: startTime
          in: query
          required: true
          schema:
            type: integer
        - name: endTime
          in: query
          required: false
          schema:
            type: integer
        - name: history
          in: query
          required: false
          schema:
            type: integer
      responses:
        "200":
          description: "Export feedback on anomalies."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FeedbackWithContext"
        "500":
          $ref: "generic_error_handling.xapi.yaml#/components/responses/genericErrorsResponse"

components:
  schemas:

    FeedbackWithContext:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - FeedbackWithContext
          type: string
        anomaly:
          $ref: '#/components/schemas/Annotation'
        data:
          $ref: '#/components/schemas/MetricTelemetry'
        feedback:
          $ref: '#/components/schemas/FeedbackData'
      required:
        - _type
        - anomaly
        - data
        - feedback
      type: object

    Annotation:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - Annotation
          type: string
        annotationType:
          $ref: '#/components/schemas/AnnotationType'
        createdTime:
          format: int64
          type: integer
        data:
          $ref: '#/components/schemas/AnnotationData'
        description:
          type: string
        eventTimeInterval:
          $ref: '#/components/schemas/TimeRange'
        id:
          type: string
        identifiers:
          items:
            type: string
          type: array
        name:
          type: string
        processedTime:
          format: int64
          type: integer
        reference:
          $ref: '#/components/schemas/Reference'
        tags:
          items:
            type: string
          type: array
      required:
        - _type
        - annotationType
        - createdTime
        - description
        - eventTimeInterval
        - id
        - identifiers
        - name
        - processedTime
        - reference
        - tags
      type: object

    AnnotationData:
      discriminator:
        propertyName: _type
      oneOf:
        - $ref: "#/components/schemas/MetricStreamAnomalyData"
        - $ref: "#/components/schemas/MetricStreamNoAnomalyData"
        - $ref: "#/components/schemas/GenericAnnotationData"
        - $ref: "#/components/schemas/FeedbackData"
      required:
        - _type
      type: object

    AnnotationMetricQuery:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - AnnotationMetricQuery
          type: string
        aggregationMethod:
          $ref: '#/components/schemas/DownsamplingMethod'
        bucketSize:
          format: int64
          type: integer
        conditions:
          items:
            $ref: '#/components/schemas/TelemetryQueryCondition'
          type: array
        dataSourceId:
          format: int64
          type: integer
        metricField:
          type: string
        queryHash:
          type: string
      required:
        - _type
        - aggregationMethod
        - bucketSize
        - conditions
        - dataSourceId
        - queryHash
      type: object

    AnnotationType:
      enum:
        - MetricStreamAnomaly
        - MetricStreamNoAnomaly
        - AnomalyFeedback
      type: string

    MetricTelemetry:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - DownsampledTelemetry
            - TelemetryTermination
            - DownsampledTelemetryData
            - UnAggregatedTelemetry
            - BaselineTelemetryData
            - BaselineTelemetry
            - MetricTelemetryData
            - MetricTelemetry
            - TelemetryError
            - MetricData
            - DownsampledMetricData
          type: string
      required:
        - _type
      type: object

    FeedbackData:
      type: object
      properties:
        _type:
          enum:
            - FeedbackData
          type: string
        query:
          $ref: '#/components/schemas/AnnotationMetricQuery'
        subject:
          type: string
        thumbsdown:
          items:
            type: string
          type: array
        thumbsup:
          items:
            type: string
          type: array
      required:
        - _type
        - subject
        - thumbsdown
        - thumbsup

    MetricStreamAnomalyData:
      properties:
        _type:
          enum:
            - MetricStreamAnomalyData
          type: string
        checkedInterval:
            $ref: '#/components/schemas/TimeRange'
        elementName:
            type: string
        explanation:
            type: string
        modelInfo:
            type: object
        query:
            $ref: '#/components/schemas/AnnotationMetricQuery'
        severity:
            $ref: '#/components/schemas/AnomalySeverity'
        severityScore:
            format: double
            type: number
        streamName:
            type: string
      required:
        - checkedInterval
        - elementName
        - explanation
        - modelInfo
        - severity
        - severityScore
        - streamName
      type: object

    MetricStreamNoAnomalyData:
      type: object
      properties:
        _type:
          enum:
            - MetricStreamNoAnomalyData
          type: string
        checkedInterval:
          $ref: '#/components/schemas/TimeRange'
        explanation:
          type: string
        modelInfo:
          type: object
        query:
          $ref: '#/components/schemas/AnnotationMetricQuery'
      required:
        - _type
        - checkedInterval
        - explanation
        - modelInfo

    GenericAnnotationData:
      type: object
      properties:
        _type:
          enum:
            - GenericAnnotationData
          type: string
        annotation:
          type: object
      required:
        - _type
        - annotation

    TimeRange:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - TimeRange
          type: string
        end:
          format: int64
          type: integer
        start:
          format: int64
          type: integer
      required:
        - _type
        - end
        - start
      type: object
    Reference:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - Reference
            - MetricStreamReference
          type: string
      required:
        - _type
      type: object
    MetricStreamReference:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - MetricStreamReference
          type: string
        elementIdentifiers:
          items:
            type: string
          type: array
        streamNodeId:
          format: int64
          type: integer
      required:
        - _type
        - elementIdentifiers
        - streamNodeId
      type: object
    DownsamplingMethod:
      enum:
        - MEAN
        - PERCENTILE_25
        - PERCENTILE_50
        - PERCENTILE_75
        - PERCENTILE_90
        - PERCENTILE_95
        - PERCENTILE_98
        - PERCENTILE_99
        - MAX
        - MIN
        - SUM
        - EVENT_COUNT
        - SUM_NO_ZEROS
        - EVENT_COUNT_NO_ZEROS
      type: string
    TelemetryQueryCondition:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - TelemetryQueryCondition
          type: string
        key:
          type: string
        value:
          type: string
      required:
        - _type
        - key
        - value
      type: object
    DownsampledMetricData:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - DownsampledMetricData
            - MetricData
          type: string
      required:
        - _type
      type: object
    DownsampledTelemetry:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - DownsampledTelemetry
            - TelemetryTermination
            - DownsampledTelemetryData
            - TelemetryError
            - MetricData
            - DownsampledMetricData
          type: string
      required:
        - _type
      type: object
    DownsampledTelemetryData:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - DownsampledTelemetryData
          type: string
        data:
          items:
            items:
              type: object
            type: array
          type: array
        downsamplingMethod:
          $ref: '#/components/schemas/DownsamplingMethod'
      required:
        - _type
        - data
        - downsamplingMethod
      type: object
    TelemetryError:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - TelemetryError
          type: string
        errors:
          items:
            $ref: '#/components/schemas/DataStreamError'
          type: array
        lastTimeStamp:
          format: int64
          type: integer
      required:
        - _type
        - errors
      type: object
    TelemetryTermination:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - TelemetryTermination
          type: string
        lastTimeStamp:
          format: int64
          type: integer
      required:
        - _type
      type: object
    BaselineTelemetry:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - BaselineTelemetry
            - BaselineTelemetryData
            - TelemetryError
            - TelemetryTermination
          type: string
      required:
        - _type
      type: object
    BaselineTelemetryData:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - BaselineTelemetryData
          type: string
        data:
          items:
            items:
              type: object
            type: array
          type: array
      required:
        - _type
        - data
      type: object
    MetricTelemetryData:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - MetricTelemetryData
          type: string
        data:
          items:
            items:
              type: object
            type: array
          type: array
        isPartial:
          type: boolean
      required:
        - _type
        - data
      type: object
    UnAggregatedTelemetry:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - UnAggregatedTelemetry
            - MetricTelemetryData
            - TelemetryError
          type: string
      required:
        - _type
      type: object
    MetricData:
      discriminator:
        propertyName: _type
      properties:
        _type:
          enum:
            - MetricData
          type: string
        isPartial:
          type: boolean
        result:
          items:
            $ref: '#/components/schemas/TimeSeries'
          type: array
      required:
        - _type
        - result
      type: object
    AnomalySeverity:
      enum:
        - LOW
        - MEDIUM
        - HIGH
      type: string